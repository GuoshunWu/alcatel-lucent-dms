// Generated by CoffeeScript 1.3.3
(function() {

  define(['jqueryui', 'appmng/dictionary_grid', 'jsfileuploader/jquery.iframe-transport', 'jsfileuploader/jquery.fileupload'], function($, grid) {
    $("#selAppVersion").change(function() {
      return grid.appChanged({
        version: $(this).find("option:selected").text(),
        id: $(this).val()
      });
    });
    $("#progressDialog").dialog({
      autoOpen: false,
      width: '600',
      height: '100'
    });
    $("#progressbar").progressbar();
    $("#dctFileUpload").css('visibility', 'hidden');
    $('#uploadBrower').button().click(function() {
      $("#dctFileUpload").trigger("click");
      return false;
    });
    $("#dctFileUpload").fileupload({
      type: 'POST',
      url: 'app/deliver-app-dict',
      add: function(e, data) {
        $.each(data.files, function(index, file) {
          return $('#uploadStatus').html("Uploading file: " + file.name);
        });
        data.submit();
        return $("#progressDialog").dialog("open");
      },
      done: function(e, data) {
        $("#progressDialog").dialog("close");
        return $.each(data.files, function(index, file) {
          return $('#uploadStatus').html("" + file.name + " upload finished.");
        });
      },
      progressall: function(e, data) {
        var progress;
        progress = data.loaded / data.total * 100;
        $('#progressbar').progressbar("value", progress);
        return $("#progressbar").children('.ui-progressbar-value').html(progress.toPrecision(3) + '%').css({
          "display": "block",
          "textAlign": "left"
        });
      }
    });
    return {
      refresh: function(info) {
        $('#appDispProductName').html(info.parent.text);
        $('#appDispAppName').html(info.text);
        return $.getJSON("rest/applications/apps/" + info.id, {}, function(json) {
          $("#selAppVersion").empty().append($(json).map(function() {
            return new Option(this.version, this.id);
          }));
          return $("#selAppVersion").trigger("change");
        });
      }
    };
  });

}).call(this);
