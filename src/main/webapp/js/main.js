// Generated by CoffeeScript 1.5.0
(function() {
  var dependencies;

  dependencies = ['jqlayout', 'dms-util', 'globallayout', 'ptree', 'appmng/main', 'transmng/main', 'taskmng/main', 'admin/main'];

  define(dependencies, function($, util, glayout, ptree, appmngPanel, transmngPanel, taskmngPanel, adminPanel) {
    var init, panelSwitchHandler, ready;
    ready = function(param) {
      if (typeof console !== "undefined" && console !== null) {
        console.debug("page ready...");
      }
      util.afterInitilized(this);
      return $('#loading-container').fadeOut('slow', function() {
        return $(this).remove();
      });
    };
    panelSwitchHandler = function(oldpnl, newpnl) {
      var options, treeSelectedNode, type, value;
      if ('admin' === oldpnl || 'admin' === newpnl) {
        return;
      }
      treeSelectedNode = $("#appTree").jstree('get_selected');
      if (0 === treeSelectedNode.length || '-1' === treeSelectedNode.attr('id')) {
        return;
      }
      if ('appmng' === newpnl) {
        type = treeSelectedNode.attr('type');
        if ('product' === type) {
          window.param.currentSelected.productId = $('#selVersion', "div[id='" + oldpnl + "']").val();
        } else {
          window.param.currentSelected.appId = $('#selVersion', "div[id='" + oldpnl + "']").val();
        }
        return $("#appTree").jstree('select_node', $("#appTree").jstree('get_selected'), true);
      } else {
        options = $('#selVersion option', "div[id='" + oldpnl + "']").clone();
        value = $('#selVersion', "div[id='" + oldpnl + "']").val();
        if ('appmng' === oldpnl && 'app' === treeSelectedNode.attr('type')) {
          options = $('#selAppVersion option', "div[id='" + oldpnl + "']").clone();
        }
        if ('appmng' !== oldpnl) {
          $('#versionTypeLabel', "div[id='" + newpnl + "']").text($("#appTree").jstree('get_text', treeSelectedNode));
        }
        return $('#selVersion', "div[id='" + newpnl + "']").empty().append(options).val(value).trigger('change');
      }
    };
    init = function() {
      var dmsPanels;
      dmsPanels = new util.PanelGroup('div.dms-panel', 'none', panelSwitchHandler);
      $('span.navigator-button').button().click(function() {
        var currentPanel, _ref;
        currentPanel = "" + ($(this).attr('value'));
        if (currentPanel === dmsPanels.currentPanel) {
          return;
        }
        if ('admin' === currentPanel) {
          glayout.layout.hide('west');
        } else {
          glayout.layout.show('west');
        }
        $("#pageNavigator").val("" + currentPanel + ".jsp");
        $('span.page-title').text($("#pageNavigator>option[value='" + currentPanel + ".jsp']").text());
        $("span[id^='nav']").removeClass('navigator-button-currentpage');
        $("span[id^='nav'][value='" + currentPanel + "']").addClass('navigator-button-currentpage');
        $("span[id^='nav'] > span.ui-button-text > span").removeClass('navigator-tab-title-currentpage');
        $("span[id^='nav'][value='" + currentPanel + "'] > span.ui-button-text > span").addClass('navigator-tab-title-currentpage');
        dmsPanels.switchTo(currentPanel);
        return (_ref = eval("" + currentPanel + "Panel")) != null ? typeof _ref.onShow === "function" ? _ref.onShow() : void 0 : void 0;
      }).parent().buttonset();
      return $("span[id^='nav'][value='appmng']").trigger('click');
    };
    init();
    return ready(this);
  });

}).call(this);
