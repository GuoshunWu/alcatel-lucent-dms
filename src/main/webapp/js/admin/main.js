// Generated by CoffeeScript 1.6.2
(function() {
  define(['require', 'jqueryui', 'i18n!nls/admin', 'i18n!nls/common', 'admin/languagegrid', 'admin/charsetgrid', 'admin/usergrid'], function(require, $, i18n, c18n) {
    var init, ready;

    init = function() {
      var pheight, tabs;

      $('#adminTabs').tabs({
        show: function(event, ui) {
          var pheight, pwidth;

          pheight = $(ui.panel).height();
          pwidth = $(ui.panel).width();
          return $('table.ui-jqgrid-btable', ui.panel).setGridHeight(pheight - 90).setGridWidth(pwidth - 20);
        }
      });
      tabs = $('#adminTabs');
      pheight = tabs.parent().height();
      tabs.tabs('option', 'pheight', pheight);
      $('div.ui-tabs-panel', tabs).height(pheight - 50);
      return $('#addUserDialog').dialog({
        autoOpen: false,
        modal: true,
        width: 500,
        create: function() {
          $('select#role', this).append($.map(i18n.usergrid.roleeditoptions.split(';'), function(entry, index) {
            var tokens;

            tokens = entry.split(':');
            return "<option value='" + tokens[0] + "'>" + tokens[1] + "</option>";
          }).join(''));
          return $('input#loginName', this).on('blur', function() {
            return $.ajax({
              url: '',
              async: false,
              success: function(data, textStatus, jqXHR) {
                $('input#name', this).val();
                return $('input#email', this).val();
              }
            });
          });
        },
        open: function() {
          $('input#loginName', this).val('');
          return $('#errMsg', this).empty();
        },
        buttons: [
          {
            text: c18n.add,
            click: function() {
              var data, errMsg;

              errMsg = '';
              data = $('#addUserForm', this).serializeArray();
              $.each(data, function(index, formItem) {
                if (!formItem.value) {
                  errMsg = "<br/><hr/>The " + formItem.name + " can't be found in system.";
                  false;
                }
                return true;
              });
              if (errMsg) {
                $('#errMsg', this).html(errMsg);
                return;
              }
              $('#userGrid').jqGrid('trigger', 'reloadGrid');
              return $(this).dialog('close');
            }
          }, {
            text: c18n.cancel,
            click: function() {
              return $(this).dialog('close');
            }
          }
        ]
      });
    };
    ready = function() {};
    init();
    return ready();
  });

}).call(this);
