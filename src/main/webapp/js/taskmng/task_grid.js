// Generated by CoffeeScript 1.3.3
(function() {

  define(['jqgrid', 'util', 'require', 'taskmng/dialogs'], function($, util, require, dialogs) {
    var handlers, taskGrid;
    handlers = {
      'Download': function(param) {
        alert('download');
        return console.log(param);
      },
      'History…': function(param) {
        alert('History…');
        return console.log(param);
      },
      'End': function(param) {
        alert('End');
        return console.log(param);
      },
      'X': function(param) {
        alert('X');
        return console.log(param);
      }
    };
    taskGrid = $("#taskGrid").jqGrid({
      url: 'json/taskgrid.json',
      mtype: 'POST',
      postData: {},
      editurl: "",
      datatype: 'json',
      width: $(window).width() * 0.95,
      height: 400,
      shrinkToFit: false,
      rownumbers: true,
      loadonce: false,
      pager: '#taskPager',
      rowNum: 60,
      rowList: [10, 20, 30, 60, 120],
      sortname: 'key',
      sortorder: 'asc',
      viewrecords: true,
      gridview: true,
      multiselect: true,
      cellEdit: true,
      cellurl: 'http://127.0.0.1:2000',
      colNames: ['Task', 'Create time', 'Last upload time', 'Actions'],
      colModel: [
        {
          name: 'task',
          index: 'task',
          width: 250,
          editable: false,
          stype: 'select',
          align: 'left',
          frozen: true
        }, {
          name: 'createtime',
          index: 'createtime',
          width: 90,
          editable: false,
          align: 'right',
          frozen: true,
          search: false
        }, {
          name: 'lastuploadtime',
          index: 'lastuploadtime',
          width: 80,
          align: 'left',
          frozen: true,
          search: false
        }, {
          name: 'actions',
          index: 'reflang',
          width: 240,
          align: 'center',
          frozen: true,
          search: false
        }
      ],
      beforeProcessing: function(data, status, xhr) {
        var actIndex, actions, k, v;
        actIndex = $(this).getGridParam('colNames').indexOf('Actions');
        --actIndex;
        if ($(this).getGridParam('multiselect')) {
          --actIndex;
        }
        actions = [];
        for (k in handlers) {
          v = handlers[k];
          actions.push(k);
        }
        return $(data.rows).each(function(index) {
          var rowData;
          rowData = this;
          return this.cell[actIndex] = $(actions).map(function(index) {
            return "<A id='action_" + this + "_" + rowData.id + "_" + actIndex + "' style='color:blue'title='" + this + "' href=#  >" + this + "</A>";
          }).get().join('&nbsp;&nbsp;&nbsp;&nbsp;');
        });
      },
      gridComplete: function() {
        var grid;
        grid = $(this);
        return $('a[id^=action_]', this).click(function() {
          var a, action, col, rowData, rowid, _ref;
          _ref = this.id.split('_'), a = _ref[0], action = _ref[1], rowid = _ref[2], col = _ref[3];
          rowData = grid.getRowData(rowid);
          delete rowData.actions;
          rowData.id = rowid;
          return handlers[action](rowData);
        });
      },
      afterCreate: function(grid) {
        return grid.navGrid('#taskPager', {
          edit: false,
          add: false,
          del: false,
          search: false,
          view: false
        });
      }
    });
    taskGrid.getGridParam('afterCreate')(taskGrid);
    $('#transReport').button({}).click(function() {
      return dialogs.transReport.dialog('open');
    });
    return $('#viewDetail').button({}).click(function() {
      return dialogs.viewDetail.dialog('open');
    });
  });

}).call(this);
